import{a as P,d as D,u as k,o as x,b as L,e as b,f as m,g as e,m as g,t as a,p as _,r as v,q as M,F as C,n as $}from"./main-C-HcNAfn.js";import{M as T,_ as A}from"./DeleteModal.vue_vue_type_script_setup_true_lang-nQrDXeaL.js";const j="https://ec-course-api.hexschool.io/",R="satarkuo-ts",f=P.create({baseURL:j});f.interceptors.request.use(s=>{const i=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");return i&&(s.headers.Authorization=i),s},s=>Promise.reject(s));f.interceptors.response.use(s=>Promise.resolve(s),s=>Promise.reject(s.response.data));const B=s=>f.get(`/v2/api/${R}/admin/coupons`,{params:s}),z=s=>f.delete(`/v2/api/${R}/admin/coupon/${s}`),E={class:"modal-dialog modal-dialog-centered modal-lg"},N={class:"modal-content rounded-lg"},U={class:"modal-body"},V={id:"modalCouponId"},F={id:"modalCouponTitle"},I={id:"modalCouponCode"},q={id:"modalCouponPercent"},G={id:"modalCouponDueDate"},H=D({__name:"CouponDetailModal",props:{coupon:{}},setup(s,{expose:i}){const u=s,c=k("modalRef");let n=null;return x(()=>{c.value&&(n=new T(c.value))}),L(()=>{n&&n.dispose()}),i({openModal:()=>{n&&n.show()},closeModal:()=>{n&&n.hide()}}),(p,t)=>(m(),b("div",{ref_key:"modalRef",ref:c,class:"modal fade",id:"couponDetailModal",tabindex:"-1","aria-labelledby":"couponDetailModalLabel","aria-hidden":"true"},[e("div",E,[e("div",N,[t[10]||(t[10]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"couponDetailModalLabel"},"優惠券詳細資訊"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",U,[e("p",null,[t[0]||(t[0]=e("strong",null,"優惠券編號:",-1)),t[1]||(t[1]=g()),e("span",V,a(u.coupon.id),1)]),e("p",null,[t[2]||(t[2]=e("strong",null,"優惠券標題:",-1)),t[3]||(t[3]=g()),e("span",F,a(u.coupon.title),1)]),e("p",null,[t[4]||(t[4]=e("strong",null,"優惠碼:",-1)),t[5]||(t[5]=g()),e("span",I,a(u.coupon.code),1)]),e("p",null,[t[6]||(t[6]=e("strong",null,"折扣:",-1)),t[7]||(t[7]=g()),e("span",q,a(p.coupon.percent/100)+" 折",1)]),e("p",null,[t[8]||(t[8]=e("strong",null,"到期日期:",-1)),e("span",G,a(new Date(u.coupon.due_date*1e3).toLocaleDateString()),1)]),e("p",null,[t[9]||(t[9]=e("strong",null,"狀態:",-1)),e("span",{id:"modalCouponEnabled",class:_(["badge",{"bg-success":p.coupon.is_enabled,"bg-gray":!p.coupon.is_enabled}])},a(p.coupon.is_enabled?"啟用":"停用"),3)])]),t[11]||(t[11]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary rounded-lg","data-bs-dismiss":"modal"},"關閉")],-1))])])],512))}}),W={class:"d-flex justify-content-end align-items-center mb-4"},J={class:"card shadow-sm rounded-lg flex-grow-1"},K={class:"card-body p-4"},O={class:"table-responsive"},Q={class:"table table-hover align-middle"},X={class:"coupon-number"},Y={class:"text-nowrap"},Z=["onClick"],ee=["onClick"],te={class:"d-flex justify-content-center mt-4"},oe={class:"pagination"},ne={class:"page-item"},se=["disabled"],le={class:"page-item"},ae=["onClick","disabled"],de={class:"page-item"},ie=["disabled"],pe=D({__name:"CouponManagement",setup(s){const i=k("couponDetailModalRef"),u=k("deleteModalRef"),c=v({code:"",due_date:0,id:"",is_enabled:0,percent:0,title:"",num:0}),n=v("1"),y=v([]),r=v({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),p=async()=>{try{const d=await B({page:n.value});y.value=d.data.coupons,r.value=d.data.pagination}catch{alert("取得優惠券列表失敗")}};x(()=>{p()});const t=(d=null)=>{d&&(c.value=d),i.value?.openModal()},w=d=>{u.value?.openModal(()=>S(d))},S=async d=>{try{await z(d)}catch{alert("刪除優惠券失敗")}finally{p()}};return(d,l)=>(m(),b(C,null,[e("div",W,[e("button",{onClick:l[0]||(l[0]=o=>t(null)),type:"button",class:"btn btn-dark rounded-lg px-4 py-2"},[...l[3]||(l[3]=[e("i",{class:"fas fa-plus me-2"},null,-1),g("新增優惠券 ",-1)])])]),e("div",J,[e("div",K,[e("div",O,[e("table",Q,[l[4]||(l[4]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"項目"),e("th",{scope:"col"},"標題"),e("th",{scope:"col"},"優惠碼"),e("th",{scope:"col"},"到期日期"),e("th",{scope:"col"},"優惠券編號"),e("th",{scope:"col"},"啟用狀態"),e("th",{scope:"col"},"折扣"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(m(!0),b(C,null,$(y.value,o=>(m(),b("tr",{key:o.id},[e("td",null,a(o.num),1),e("td",null,a(o.title),1),e("td",null,a(o.code),1),e("td",null,a(new Date(o.due_date*1e3).toLocaleDateString("zh-TW")),1),e("td",X,a(o.id),1),e("td",null,[e("span",{class:_(["badge",{"bg-success":o.is_enabled,"bg-gray":!o.is_enabled}])},a(o.is_enabled?"啟用":"停用"),3)]),e("td",null,a(o.percent/100)+" 折",1),e("td",Y,[e("button",{onClick:h=>t(o),type:"button",class:"btn btn-sm btn-outline-dark rounded-lg me-2"},"查看",8,Z),e("button",{onClick:h=>w(o.id),type:"button",class:"btn btn-sm btn-outline-danger rounded-lg"},"刪除",8,ee)])]))),128))])])]),e("nav",te,[e("ul",oe,[e("li",ne,[e("button",{onClick:l[1]||(l[1]=o=>n.value=String(Number(n.value)-1)),disabled:!r.value?.has_pre,type:"button",class:_(["page-link",{disabled:!r.value?.has_pre}]),"aria-label":"Previous"},[...l[5]||(l[5]=[e("span",{"aria-hidden":"true"},"«",-1)])],10,se)]),(m(!0),b(C,null,$(r.value?.total_pages,o=>(m(),b("li",le,[e("button",{onClick:h=>n.value=o.toString(),disabled:n.value===o.toString(),type:"button",class:_(["page-link",{active:n.value===o.toString()}])},a(o),11,ae)]))),256)),e("li",de,[e("button",{onClick:l[2]||(l[2]=o=>n.value=String(Number(n.value)+1)),disabled:!r.value?.has_next,class:_(["page-link",{disabled:!r.value?.has_next}]),type:"button","aria-label":"Next"},[...l[6]||(l[6]=[e("span",{"aria-hidden":"true"},"»",-1)])],10,ie)])])])])]),M(H,{ref_key:"couponDetailModalRef",ref:i,coupon:c.value},null,8,["coupon"]),M(A,{ref_key:"deleteModalRef",ref:u,title:"刪除優惠券",content:"確定要刪除該優惠券嗎？"},null,512)],64))}});export{pe as default};
