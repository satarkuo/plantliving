import{a as E,r as m,d as P,u as w,o as j,b as A,w as T,c as B,e as b,f as v,g as e,j as y,t as l,i as N,v as F,h as x,p as $,q as R,F as D,n as S}from"./main-D6YWl817.js";import{M as U,_ as V}from"./DeleteModal.vue_vue_type_script_setup_true_lang-syorv_ec.js";const z="https://ec-course-api.hexschool.io/",k="satarkuo-ts",g=E.create({baseURL:z});g.interceptors.request.use(n=>{const a=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");return a&&(n.headers.Authorization=a),n},n=>Promise.reject(n));g.interceptors.response.use(n=>Promise.resolve(n),n=>Promise.reject(n.response.data));const I=n=>g.get(`/v2/api/${k}/admin/coupons`,{params:n}),G=n=>g.delete(`/v2/api/${k}/admin/coupon/${n}`),q=n=>g.post(`/v2/api/${k}/admin/coupon`,{data:n}),H=n=>{const{data:a,id:r}=n;return g.put(`/v2/api/${k}/admin/coupon/${r}`,{data:a})},L=()=>({code:"",due_date:0,id:"",is_enabled:0,percent:0,title:"",num:0});function W(){const n=m(L()),a=m("新增優惠券"),r=u=>{u?(n.value={...u},a.value="編輯優惠券"):f()},f=()=>{n.value=L(),a.value="新增優惠券"};return{form:n,formTitle:a,loadCoupon:r,resetForm:f}}const J={class:"modal-dialog modal-dialog-centered modal-lg"},K={class:"modal-content rounded-lg"},O={class:"modal-body"},Q={id:"modalCouponId"},X={class:"mb-3"},Y={id:"modalCouponTitle"},Z={id:"modalCouponCode"},ee={id:"modalCouponPercent"},te={id:"modalCouponDueDate"},oe={class:"modal-footer"},ne=["disabled"],se=P({__name:"CouponModal",props:{coupon:{}},emits:["get-coupons"],setup(n,{expose:a,emit:r}){const f=r,u=w("modalRef");let s=null;j(()=>{u.value&&(s=new U(u.value))}),A(()=>{s&&s.dispose()});const h=()=>{s&&s.show()},i=()=>{s&&s.hide()},{form:p,loadCoupon:_}=W();T(()=>n.coupon,o=>{o.id?_(o):_(null)},{immediate:!0,deep:!0});const M=B(()=>!!n.coupon.id),C=m(!1),d=async()=>{const{id:o,...t}=p.value,c={...t};C.value=!0;try{M.value&&o?await H({data:c,id:o}):await q(c),i()}catch{alert("新增/編輯優惠券失敗")}finally{C.value=!1,f("get-coupons")}};return a({openModal:h,closeModal:i}),(o,t)=>(v(),b("div",{ref_key:"modalRef",ref:u,class:"modal fade",id:"couponDetailModal",tabindex:"-1","aria-labelledby":"couponDetailModalLabel","aria-hidden":"true"},[e("div",J,[e("div",K,[t[12]||(t[12]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"couponDetailModalLabel"},"優惠券詳細資訊"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",O,[e("p",null,[t[1]||(t[1]=e("strong",null,"優惠券編號:",-1)),t[2]||(t[2]=y()),e("span",Q,l(o.coupon.id),1)]),e("form",null,[e("div",X,[t[3]||(t[3]=e("label",{for:"productName",class:"form-label"},"優惠券標題",-1)),N(e("input",{"onUpdate:modelValue":t[0]||(t[0]=c=>x(p).title=c),type:"text",class:"form-control rounded-lg",id:"couponName"},null,512),[[F,x(p).title]])])]),e("p",null,[t[4]||(t[4]=e("strong",null,"優惠券標題:",-1)),t[5]||(t[5]=y()),e("span",Y,l(o.coupon.title),1)]),e("p",null,[t[6]||(t[6]=e("strong",null,"優惠碼:",-1)),t[7]||(t[7]=y()),e("span",Z,l(o.coupon.code),1)]),e("p",null,[t[8]||(t[8]=e("strong",null,"折扣:",-1)),t[9]||(t[9]=y()),e("span",ee,l(o.coupon.percent/100)+" 折",1)]),e("p",null,[t[10]||(t[10]=e("strong",null,"到期日期:",-1)),e("span",te,l(new Date(o.coupon.due_date*1e3).toLocaleDateString()),1)]),e("p",null,[t[11]||(t[11]=e("strong",null,"狀態:",-1)),e("span",{id:"modalCouponEnabled",class:$(["badge",{"bg-success":o.coupon.is_enabled,"bg-gray":!o.coupon.is_enabled}])},l(o.coupon.is_enabled?"啟用":"停用"),3)])]),e("div",oe,[e("button",{onClick:i,type:"button",class:"btn btn-outline-secondary rounded-lg"},"取消"),e("button",{onClick:d,disabled:C.value,type:"button",class:"btn btn-dark rounded-lg"},"儲存",8,ne)])])])],512))}}),le={class:"d-flex justify-content-end align-items-center mb-4"},ae={class:"card shadow-sm rounded-lg flex-grow-1"},de={class:"card-body p-4"},ie={class:"table-responsive"},ue={class:"table table-hover align-middle"},re={class:"coupon-number"},pe={class:"text-nowrap"},ce=["onClick"],me=["onClick"],be={class:"d-flex justify-content-center mt-4"},ve={class:"pagination"},ge={class:"page-item"},fe=["disabled"],_e={class:"page-item"},Ce=["onClick","disabled"],ye={class:"page-item"},$e=["disabled"],De=P({__name:"CouponManagement",setup(n){const a=w("couponDetailModalRef"),r=w("deleteModalRef"),u=m({code:"",due_date:0,id:"",is_enabled:0,percent:0,title:"",num:0}),s=m("1"),h=m([]),i=m({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),p=async()=>{try{const d=await I({page:s.value});h.value=d.data.coupons,i.value=d.data.pagination}catch{alert("取得優惠券列表失敗")}};T(s,p,{immediate:!0});const _=(d=null)=>{u.value=d?{...d}:{code:"",due_date:0,id:"",is_enabled:0,percent:0,title:"",num:0},a.value?.openModal()},M=d=>{r.value?.openModal(()=>C(d))},C=async d=>{try{await G(d)}catch{alert("刪除優惠券失敗")}finally{p()}};return(d,o)=>(v(),b(D,null,[e("div",le,[e("button",{onClick:o[0]||(o[0]=t=>_(null)),type:"button",class:"btn btn-dark rounded-lg px-4 py-2"},[...o[3]||(o[3]=[e("i",{class:"fas fa-plus me-2"},null,-1),y("新增優惠券 ",-1)])])]),e("div",ae,[e("div",de,[e("div",ie,[e("table",ue,[o[4]||(o[4]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"項目"),e("th",{scope:"col"},"標題"),e("th",{scope:"col"},"優惠碼"),e("th",{scope:"col"},"到期日期"),e("th",{scope:"col"},"優惠券編號"),e("th",{scope:"col"},"啟用狀態"),e("th",{scope:"col"},"折扣"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(v(!0),b(D,null,S(h.value,t=>(v(),b("tr",{key:t.id},[e("td",null,l(t.num),1),e("td",null,l(t.title),1),e("td",null,l(t.code),1),e("td",null,l(new Date(t.due_date*1e3).toLocaleDateString("zh-TW")),1),e("td",re,l(t.id),1),e("td",null,[e("span",{class:$(["badge",{"bg-success":t.is_enabled,"bg-gray":!t.is_enabled}])},l(t.is_enabled?"啟用":"停用"),3)]),e("td",null,l(t.percent/100)+" 折",1),e("td",pe,[e("button",{onClick:c=>_(t),type:"button",class:"btn btn-sm btn-outline-dark rounded-lg me-2"},"查看",8,ce),e("button",{onClick:c=>M(t.id),type:"button",class:"btn btn-sm btn-outline-danger rounded-lg"},"刪除",8,me)])]))),128))])])]),e("nav",be,[e("ul",ve,[e("li",ge,[e("button",{onClick:o[1]||(o[1]=t=>s.value=String(Number(s.value)-1)),disabled:!i.value?.has_pre,type:"button",class:$(["page-link",{disabled:!i.value?.has_pre}]),"aria-label":"Previous"},[...o[5]||(o[5]=[e("span",{"aria-hidden":"true"},"«",-1)])],10,fe)]),(v(!0),b(D,null,S(i.value?.total_pages,t=>(v(),b("li",_e,[e("button",{onClick:c=>s.value=t.toString(),disabled:s.value===t.toString(),type:"button",class:$(["page-link",{active:s.value===t.toString()}])},l(t),11,Ce)]))),256)),e("li",ye,[e("button",{onClick:o[2]||(o[2]=t=>s.value=String(Number(s.value)+1)),disabled:!i.value?.has_next,class:$(["page-link",{disabled:!i.value?.has_next}]),type:"button","aria-label":"Next"},[...o[6]||(o[6]=[e("span",{"aria-hidden":"true"},"»",-1)])],10,$e)])])])])]),R(se,{ref_key:"couponDetailModalRef",ref:a,coupon:u.value,onGetCoupons:p},null,8,["coupon"]),R(V,{ref_key:"deleteModalRef",ref:r,title:"刪除優惠券",content:"確定要刪除該優惠券嗎？"},null,512)],64))}});export{De as default};
