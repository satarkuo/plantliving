import{a as A,r as g,d as N,u as T,o as B,b as F,w as j,c as E,e as _,f,g as e,t as c,h as m,m as z,i as C,v as D,j as R,k as G,q as U,F as P,n as I,p as w}from"./main-DEOICPyM.js";import{M as q,_ as H}from"./DeleteModal.vue_vue_type_script_setup_true_lang-CebJMrMY.js";const O="https://ec-course-api.hexschool.io/",S="satarkuo-ts",h=A.create({baseURL:O});h.interceptors.request.use(o=>{const i=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");return i&&(o.headers.Authorization=i),o},o=>Promise.reject(o));h.interceptors.response.use(o=>Promise.resolve(o),o=>Promise.reject(o.response.data));const W=o=>h.get(`/v2/api/${S}/admin/coupons`,{params:o}),J=o=>h.delete(`/v2/api/${S}/admin/coupon/${o}`),K=o=>h.post(`/v2/api/${S}/admin/coupon`,{data:o}),Q=o=>{const{data:i,id:v}=o;return h.put(`/v2/api/${S}/admin/coupon/${v}`,{data:i})},L=()=>({code:"",due_date:0,id:"",is_enabled:0,percent:0,title:"",num:0});function X(){const o=g(L()),i=g("新增優惠券"),v=b=>{b?(o.value={...b},i.value="編輯優惠券"):y()},y=()=>{o.value=L(),i.value="新增優惠券"};return{form:o,formTitle:i,loadCoupon:v,resetForm:y}}const Y={class:"modal-dialog modal-dialog-centered modal-md"},Z={class:"modal-content rounded-lg"},ee={class:"modal-header"},te={class:"modal-title",id:"couponDetailModalLabel"},oe={class:"modal-body"},le={key:0},se={id:"modalCouponId"},ne={class:"text-secondary ms-2"},ae={class:"row"},de={class:"col-6"},ie={class:"mb-3"},ue={class:"mb-3"},re={class:"mb-3 d-flex align-items-center"},ce={class:"form-check form-switch"},pe={class:"form-check-label",for:"couponEnabledSwitch"},me={class:"col-6"},be={class:"mb-3"},ve={class:"mb-3"},_e={class:"modal-footer"},fe=["disabled"],ge=N({__name:"CouponModal",props:{coupon:{}},emits:["get-coupons"],setup(o,{expose:i,emit:v}){const y=v,b=T("modalRef");let a=null;B(()=>{b.value&&(a=new q(b.value))}),F(()=>{a&&a.dispose()});const k=()=>{a&&a.show()},p=()=>{a&&a.hide()},{form:s,formTitle:$,loadCoupon:x}=X();console.log("form =>",s),j(()=>o.coupon,u=>{u.id?x(u):(x(null),s.value.is_enabled=1)},{immediate:!0,deep:!0});const M=E(()=>!!o.coupon.id),d=g(!1),n=E({get(){return s.value.due_date?new Date(s.value.due_date*1e3).toISOString().slice(0,10):""},set(u){u?s.value.due_date=Math.floor(new Date(u).getTime()/1e3):s.value.due_date=0}}),l=async()=>{const{id:u,num:t,...r}=s.value,V={...r};d.value=!0;try{M.value&&u?await Q({data:V,id:u}):await K(V),p()}catch{alert("新增/編輯優惠券失敗")}finally{d.value=!1,y("get-coupons")}};return i({openModal:k,closeModal:p}),(u,t)=>(f(),_("div",{ref_key:"modalRef",ref:b,class:"modal fade",id:"couponDetailModal",tabindex:"-1","aria-labelledby":"couponDetailModalLabel","aria-hidden":"true"},[e("div",Y,[e("div",Z,[e("div",ee,[e("h5",te,c(m($)),1),t[5]||(t[5]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",oe,[M.value?(f(),_("p",le,[t[6]||(t[6]=e("strong",null,"ID編號",-1)),e("span",se,[e("small",ne,c(u.coupon.id),1)])])):z("",!0),e("form",null,[e("div",ae,[e("div",de,[e("div",ie,[t[7]||(t[7]=e("label",{for:"couponName",class:"form-label"},[e("strong",null,"優惠券標題")],-1)),C(e("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>m(s).title=r),type:"text",class:"form-control rounded-lg",id:"couponName",placeholder:"請輸入優惠券標題"},null,512),[[D,m(s).title]])]),e("div",ue,[t[8]||(t[8]=e("label",{for:"couponPercent",class:"form-label"},[e("strong",null,[R("折扣"),e("small",{class:"text-muted ms-1"},"（1–99，例: 80 = 8 折）")])],-1)),C(e("input",{"onUpdate:modelValue":t[1]||(t[1]=r=>m(s).percent=r),type:"number",min:"1",max:"99",class:"form-control rounded-lg",id:"couponPercent"},null,512),[[D,m(s).percent,void 0,{number:!0}]])]),e("div",re,[t[9]||(t[9]=e("strong",{class:"me-3"},"狀態",-1)),e("div",ce,[C(e("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>m(s).is_enabled=r),class:"form-check-input",type:"checkbox",id:"couponEnabledSwitch","true-value":1,"false-value":0},null,512),[[G,m(s).is_enabled]]),e("label",pe,c(m(s).is_enabled?"啟用":"停用"),1)])])]),e("div",me,[e("div",be,[t[10]||(t[10]=e("label",{for:"couponCode",class:"form-label"},[e("strong",null,"優惠碼")],-1)),C(e("input",{"onUpdate:modelValue":t[3]||(t[3]=r=>m(s).code=r),type:"text",class:"form-control rounded-lg",id:"couponCode",placeholder:"請輸入優惠碼"},null,512),[[D,m(s).code]])]),e("div",ve,[t[11]||(t[11]=e("label",{for:"couponDueDate",class:"form-label"},[e("strong",null,"到期日期")],-1)),C(e("input",{"onUpdate:modelValue":t[4]||(t[4]=r=>n.value=r),type:"date",class:"form-control rounded-lg",id:"couponDueDate",placeholder:"請選擇到期日期"},null,512),[[D,n.value]])])])])])]),e("div",_e,[e("button",{onClick:p,type:"button",class:"btn btn-outline-secondary rounded-lg"},"取消"),e("button",{onClick:l,disabled:d.value,type:"button",class:"btn btn-dark rounded-lg"},"儲存",8,fe)])])])],512))}}),he={class:"d-flex justify-content-end align-items-center mb-4"},ye={class:"card shadow-sm rounded-lg flex-grow-1"},Ce={class:"card-body p-4"},ke={class:"table-responsive"},$e={class:"table table-hover align-middle"},xe={class:"text-secondary"},Me={class:"text-nowrap"},De=["onClick"],we=["onClick"],Re={class:"d-flex justify-content-center mt-4"},Se={class:"pagination"},Pe={class:"page-item"},Te=["disabled"],Ve={class:"page-item"},Ee=["onClick","disabled"],Ue={class:"page-item"},Ie=["disabled"],Ae=N({__name:"CouponManagement",setup(o){const i=T("couponDetailModalRef"),v=T("deleteModalRef"),b=g({code:"",due_date:0,id:"",is_enabled:0,percent:0,title:"",num:0}),a=g("1"),k=g([]),p=g({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),s=async()=>{try{const d=await W({page:a.value});k.value=d.data.coupons,p.value=d.data.pagination}catch{alert("取得優惠券列表失敗")}};j(a,s,{immediate:!0});const $=(d=null)=>{b.value=d?{...d}:{code:"",due_date:0,id:"",is_enabled:0,percent:0,title:"",num:0},i.value?.openModal()},x=d=>{v.value?.openModal(()=>M(d))},M=async d=>{try{await J(d)}catch{alert("刪除優惠券失敗")}finally{s()}};return(d,n)=>(f(),_(P,null,[e("div",he,[e("button",{onClick:n[0]||(n[0]=l=>$(null)),type:"button",class:"btn btn-dark rounded-lg px-4 py-2"},[...n[3]||(n[3]=[e("i",{class:"fas fa-plus me-2"},null,-1),R("新增優惠券 ",-1)])])]),e("div",ye,[e("div",Ce,[e("div",ke,[e("table",$e,[n[5]||(n[5]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"項目"),e("th",{scope:"col"},[R("標題 "),e("small",{class:"text-secondary"},"| ID 編號")]),e("th",{scope:"col"},"優惠碼"),e("th",{scope:"col"},"折扣"),e("th",{scope:"col"},"到期日期"),e("th",{scope:"col"},"啟用狀態"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(f(!0),_(P,null,I(k.value,l=>(f(),_("tr",{key:l.id},[e("td",null,c(l.num),1),e("td",null,[R(c(l.title),1),n[4]||(n[4]=e("br",null,null,-1)),e("small",xe,c(l.id),1)]),e("td",null,c(l.code),1),e("td",null,c(l.percent/10)+" 折",1),e("td",null,c(new Date(l.due_date*1e3).toLocaleDateString("zh-TW")),1),e("td",null,[e("span",{class:w(["badge",{"bg-success":l.is_enabled,"bg-light text-secondary":!l.is_enabled}])},c(l.is_enabled?"啟用":"停用"),3)]),e("td",Me,[e("button",{onClick:u=>$(l),type:"button",class:"btn btn-sm btn-outline-dark rounded-lg me-2"},"查看",8,De),e("button",{onClick:u=>x(l.id),type:"button",class:"btn btn-sm btn-outline-danger rounded-lg"},"刪除",8,we)])]))),128))])])]),e("nav",Re,[e("ul",Se,[e("li",Pe,[e("button",{onClick:n[1]||(n[1]=l=>a.value=String(Number(a.value)-1)),disabled:!p.value?.has_pre,type:"button",class:w(["page-link",{disabled:!p.value?.has_pre}]),"aria-label":"Previous"},[...n[6]||(n[6]=[e("span",{"aria-hidden":"true"},"«",-1)])],10,Te)]),(f(!0),_(P,null,I(p.value?.total_pages,l=>(f(),_("li",Ve,[e("button",{onClick:u=>a.value=l.toString(),disabled:a.value===l.toString(),type:"button",class:w(["page-link",{active:a.value===l.toString()}])},c(l),11,Ee)]))),256)),e("li",Ue,[e("button",{onClick:n[2]||(n[2]=l=>a.value=String(Number(a.value)+1)),disabled:!p.value?.has_next,class:w(["page-link",{disabled:!p.value?.has_next}]),type:"button","aria-label":"Next"},[...n[7]||(n[7]=[e("span",{"aria-hidden":"true"},"»",-1)])],10,Ie)])])])])]),U(ge,{ref_key:"couponDetailModalRef",ref:i,coupon:b.value,onGetCoupons:s},null,8,["coupon"]),U(H,{ref_key:"deleteModalRef",ref:v,title:"刪除優惠券",content:"確定要刪除該優惠券嗎？"},null,512)],64))}});export{Ae as default};
